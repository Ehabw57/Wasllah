<!doctype html>
<html>
  <head>
    <title>wassla</title>
  </head>
  <body>
    <h1>connected Devices:</h1>
    <div id="devices"></div>
    <script>
        const socket = new WebSocket("ws://localhost:3000");
        const devicesDiv = document.getElementById("devices");

        socket.onopen = () => {
            console.log ("Connected to server")
            const name  = navigator.platform;
            socket.send(JSON.stringify({ type: "auth", name }));
        }

        socket.onmessage = (event) => {
          const data = JSON.parse(event.data)
          if (data.type === 'connectedClients') {
            data.clients.forEach(client => {
              const device = document.createElement("div");
              device.id = client.id
              device.textContent = `Device: ${client.name} (ID: ${client.id}, Origin: ${client.origin})`;
              devicesDiv.appendChild(device);
            });
          }
          if (data.type === "connection") {
            const device = document.createElement("div");
            device.id = data.id
            device.textContent = `Device: ${data.name} (ID: ${data.id}, Origin: ${data.origin})`;
            devicesDiv.appendChild(device);
          }

          if (data.type === "disconnection") {
            const device = document.getElementById(data.id);
            console.log(`Device disconnected: ID ${data.id}`);
            if (device) {
              devicesDiv.removeChild(device);
            }
          }
        }
    </script>
  </body>
</html>
